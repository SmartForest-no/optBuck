% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/buckStem.R
\name{buckStem}
\alias{buckStem}
\title{buckStem}
\usage{
buckStem(
  stem,
  ProductData,
  PriceMatrices,
  PermittedGrades,
  StemKey = NA_integer_
)
}
\arguments{
\item{stem}{data.frame or data.table containing a stem profile on a 10 cm grid. Must include
columns \code{diameterPosition} (cm), \code{DiameterValue} (mm), \code{StemGrade},
and \code{SpeciesGroupKey}. If \code{StemKey} is present it is ignored unless passed via \code{StemKey}.}

\item{ProductData}{data.frame or data.table with product definitions. Must include
\code{ProductKey}, \code{SpeciesGroupKey}, \code{LengthClassLowerLimit}, \code{LengthClassMAX},
\code{DiameterClassLowerLimit}, and \code{DiameterClassMAX}.}

\item{PriceMatrices}{named list of price matrices indexed by \code{ProductKey} (character). Each matrix must have
row names as length classes (cm) and column names as diameter classes (mm). Values are prices per volume unit.}

\item{PermittedGrades}{named list indexed by \code{ProductKey} (character). Each element is an integer vector of
stem grades permitted for that product. A candidate segment is feasible for a product if all stem grades observed
within the segment are contained in the product's permitted grade set.}

\item{StemKey}{optional integer stem identifier included in the returned table.}
}
\value{
A \code{data.table} with the optimal bucking solution, one row per log, containing
  \code{StemKey}, \code{LogKey}, \code{StartPos} (cm), \code{StopPos} (cm), \code{Top_ub} (mm),
  \code{LogLength} (cm), \code{ProductKey}, \code{Volume}, \code{Value}, and \code{CumulativeValue}.
  Returns an empty \code{data.table} if no feasible solution is found.
}
\description{
Optimal bucking of a single tree stem using dynamic programming.
}
\details{
The algorithm evaluates all feasible transitions between diameter positions on a 10 cm grid.
For each candidate log segment, feasibility is determined by length and diameter class limits from \code{ProductData}
and by the requirement that all stem grades encountered in the segment are permitted by the product.
Prices are looked up in \code{PriceMatrices} by flooring length and diameter to the nearest lower class boundary.
Volume is computed with a frustum approximation based on rotation diameter at the segment start and top diameter at the segment end.
}
\references{
Skogforsk 2011. Introduction to StanForD 2010. URL: Skogforsk.
https://www.skogforsk.se/contentassets/1a68cdce4af1462ead048b7a5ef1cc06/stanford-2010-introduction-150826.pdf
}
\author{
Lennart Noordermeer \email{lennart.noordermeer@nmbu.no}
}
